statfinder_modifier_table = {
	["modifier_dispel_tenacity"] = {
		{ "added_tenacity", 35 },
	},
	["modifier_bastion_resists"] = {
		{ "added_armour", 20 },
		{ "added_magic_resistance", 20 },
	},
	["modifier_nox_aeterna_damage_reduction"] = {
		{ "added_damage_taken", -0.1 },
	},
	["modifier_focus_shaper_double_edge_damage"] = {
		{ "multiplied_attack_damage", 0.2 },
	},
	["whale_hunter_surge_bonus_attack_damage"] = {
		{ "added_attack_damage", 1 },
	},
	["modifier_black_ice_armour"] = {
		{"added_armour", 1}
	},
	["item_strife_power_bonus"] = {
		{ "added_power", 1 },
	},
	["modifier_reverie_power"] = {
		{ "added_power", 1 },
	},
	["modifier_iceberg_power"] = {
		{ "added_power", 5 },
	},
	["modifier_targetting_shaper"] = {
		{ "added_defense_penetration", 70 },
	},
	["modifier_targetting_shaper_stack"] = {
		{ "added_power", 1 },
		{ "added_haste", 0.5 },
	},	
	["modifier_rotting_tomb_slow"] = {
		{ "added_attackspeed_percent", -0.15, -0.20, -0.25, -0.30, -0.35},
	},
	["modifier_rage_mounting_fury_hidden"] = {
		{ "added_haste", 1 },
	},
	["modifier_health_shaper_power"] = {
		{ "added_power", 1 },
	},
	["modifier_alpha_unyielding_march_power"] = {
		{ "added_power", 1 },
	},
	["modifier_jungle_buff_power"] = {
		{ "added_power", 15 },
		{ "multiplied_power", 0.1 },
	},
	["modifier_jungle_buff_haste"] = {
		{ "added_haste", 20 },
	},
	["modifier_jungle_buff_haste_use_ability"] = {
		{ "added_haste", 20 },
	},
	["modifier_high_huntress_chase_haste_bonus"] = {
		{ "added_haste", 5 }
	},
	["modifier_item_hostility_datadriven_aura"] = {
		{ "added_mastery", 10 },
		{ "added_power", 15 },
	},
	["modifier_item_destruction_pen"] = {
		{ "added_defense_penetration", 30 },
	},
	["modifier_dominance_obliterate"] = {
		{ "added_obliterate", 1.5 },
	},
    ["modifier_black_ice"] = {
        { "added_armour", 6 },
    },
	["modifier_inner_peace"] = {
		{ "added_power", -10 },
	},
	["modifier_sculptor_embrace"] = {
		{ "added_armour", 1 }
	},
	["modifier_cerulean_armour"] = {
		{ "added_armour", 1 },
		{ "added_magic_resistance", 1 }
	},
	["modifier_hidden_level_armour"] = {
		{ "added_armour", 1}
	},
	["modifier_hidden_level_magic_resistance"] = {
		{ "added_magic_resistance", 1}
	},
	["modifier_soul_collector"] = {
		{ "added_power", 0.5 },
	},
	["modifier_strife_soul_collector"] = {
		{ "added_power", 0.5 },
	},
	["modifier_soul_collector_decay"] = {
		{ "added_power", 0.5 },
	},
    ["modifier_will_thief_gain"] = {
        { "added_magic_resistance", 3 }
    },
    ["modifier_will_thief_lose"] = {
        { "added_magic_resistance", -3 }
    },
    ["modifier_command_surge"] = {
        { "multiplied_power", 0.1 }
    },
    ["modifier_shield_wall"] = {
        { "added_armour", 35 },
        { "added_magic_resistance", 35 }
    },
    ["item_prosperity_stack"] = {
        { "added_armour", 3 },
        { "added_magic_resistance", 2 }
    },
    ["item_harmony_power"] = {
        { "added_power", 20 }
    },
	["modifier_hell_devourer_vengeance_hidden"] = {
		{ "added_haste", 1 }
	},
	["modifier_hell_devourer_damnation_hidden"] = {
		{ "added_lifedrain", 1 }
	},
	["modifier_art_prodigy_splatter_mr_reduction"] = {
		{ "added_magic_resistance", -1 }
	},
	["modifier_muse_bonus_power"] = {
		{ "added_power", 1 }
	},
	["modifier_muse_bonus_haste"] = {
		{ "added_haste", 1 }
	},
	["modifier_muse_bonus_lifedrain"] = {
		{ "added_lifedrain", 1 }
	},
	["modifier_muse_bonus_magic_resistance"] = {
		{ "added_magic_resistance", 1 }
	},
	["modifier_muse_bonus_armour"] = {
		{ "added_armour", 1 }
	},
	["modifier_muse_passive_power"] = {
		{ "added_power", 1 }
	},
	["modifier_prismatic_vortex_power_gain"] = {
		{ "added_power", 1 }
	},
	["modifier_prismatic_vortex_power_loss"] = {
		{ "added_power", -1 }
	},
	["modifier_ambition_stack"] = {
		{ "added_haste", 3 },
		{ "added_lifedrain", 1 }
	},
	["modifier_voracity_stack"] = {
		{ "added_power", 7 },
		{ "added_lifedrain", 1 }
	},
	["modifier_item_devotion_datadriven_aura"] = {
		{ "added_armour", 20 }, 
		{ "added_magic_resistance", 20 }
	},
	["modifier_ablative_armour"] = {
		{ "added_power", 5 }
	},
	["modifier_equilibrium_subdued"] = {
		{ "added_power", -10 }
	},
	["modifier_item_hope_stack_armour"] = {
		{ "added_armour", 1 }, 
	},
	["modifier_item_hope_stack_magic_resistance"] = {
		{ "added_magic_resistance", 1 }, 
	},
	["modifier_item_oppression_datadriven_aura"] = {
		{ "added_magic_resistance", -15 },
	},
	["item_justice_power_overwhelming"] = {
		{ "multiplied_power",   0.1 },
		{ "multiplied_haste",   0.2 },
		{ "multiplied_mastery", 0.2 },
	},
	["modifier_exceed"] = {
		{ "multiplied_power",   0.3 },
		{ "added_power", 30 },
	},
	["modifier_valor_power"] = {
		{ "added_power", 1 },
	},
	["item_judgement_sundering_strikes_armour_visible"] = {
		{ "multiplied_armour", -0.05 },
	},
	["item_judgement_sundering_strikes_magic_resistance_visible"] = {
		{ "multiplied_magic_resistance", -0.05 },
	},
	["modifier_flesh_skewer_armour_reduction"] = {
		{ "multiplied_armour", -0.15 },
	},
	["modifier_jungle_buff_armour"] = {
		{ "added_armour", 20 },
	}
}
function find_stat(npc, stat)
	local statTotal = 0
	if stat == "attack_damage" then
		statTotal = npc:GetAttackDamage()
	end
    local statTotalMultplied = 1
	for i = 0, 5 do
		local itemFound = npc:GetItemInSlot(i)
		if itemFound ~= nil then
			local statFound = itemFound:GetSpecialValueFor("added_" .. stat)
			statTotal = statTotal + statFound
            statTotalMultplied = statTotalMultplied + itemFound:GetSpecialValueFor("multiplied_" .. stat)
		end
	end
	for i = 0, npc:GetModifierCount() do
		local mod = npc:GetModifierNameByIndex(i)
		local mods = statfinder_modifier_table[mod]
		if mods ~= nil then
			for i = 1, table.getn(mods) do
				local j = 1
				while true do
					if mods[i][j] == nil then
						break
					end
					if mods[i][j] == "added_" .. stat then
						local multi = 0
						if npc:GetModifierStackCount(mod, nil) == 0 then
							multi = 1
						else
							multi = npc:GetModifierStackCount(mod, nil)
						end
						statTotal = statTotal + mods[i][j + 1] * multi
					end
                    if mods[i][j] == "multiplied_" .. stat then
						local multi = 0
						if npc:GetModifierStackCount(mod, nil) == 0 then
							multi = 1
						else
							multi = npc:GetModifierStackCount(mod, nil)
						end
						statTotalMultplied = statTotalMultplied + mods[i][j + 1] * multi
					end
					j = j + 2
				end
			end
		end
	end
    if stat == "power" then
        statTotal = statTotal + (find_unique_passive(npc, "added_life_percent_as_power", false) * npc:GetMaxHealth()) / 100
        statTotal = statTotal + (find_unique_passive(npc, "added_power_percent_as_power", false) * statTotal) / 100
        if npc.creep_level_power ~= nil then
        	statTotal = statTotal + npc.creep_level_power
        end
    end
    if stat == "armour" then
        if npc.creep_level_armour ~= nil then
        	statTotal = statTotal + npc.creep_level_armour
        end
    end
    if stat == "magic_resistance" then
        if npc.creep_level_magic_resistance ~= nil then
        	statTotal = statTotal + npc.creep_level_magic_resistance
        end
    end
	return statTotal * math.max(0, statTotalMultplied)
end
function find_unique_passive(npc, passive, negative)
	local passiveTotal = 0
	for i = 0, 5 do
		local itemFound = npc:GetItemInSlot(i)
		if itemFound ~= nil then
			local passiveFound = itemFound:GetSpecialValueFor(passive)
            if negative then
                passiveTotal = math.min(passiveTotal, passiveFound)
            else
                passiveTotal = math.max(passiveTotal, passiveFound)
            end
		end
	end
	return passiveTotal
end
function find_item(npc, itemname)
    for i = 0, 5 do
        if npc:GetItemInSlot(i) ~= nil and npc:GetItemInSlot(i):GetAbilityName() == itemname then
            return npc:GetItemInSlot(i)
        end
    end
    return nil
end
function count_items(npc, itemname) 
	local count = 0
	for i = 0, 5 do
		if npc:GetItemInSlot(i) ~= nil and npc:GetItemInSlot(i):GetAbilityName() == itemname then
			count = count + 1
		end
	end
	return count
end
function count_modifiers(npc, modifier_name)
	local count = 0
	for i = 1, npc:GetModifierCount() do
		if npc:GetModifierNameByIndex(i) == modifier_name then
			count = count + 1
		end
	end
	return count
end